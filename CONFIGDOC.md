You can use the Jenkins&trade; plugin for MATLAB&reg; in freestyle and multi-configuration projects. This guide demonstrates how to run MATLAB code on Jenkins, considering a Microsoft&reg; Windows&reg; platform.

-  [Build Step Overview](#build-step-overview)
-  [Freestyle Project Setup](#freestyle-project-setup)
-  [Multi-Configuration Project Setup](#multi-configuration-project-setup)


## Build Step Overview
The plugin provides you with the **Run MATLAB Tests** and **Run MATLAB Command** build steps. With the Jenkins plugin for MATLAB, you have the option to run your tests in

either *automatic* or *custom* mode. 
### Run MATLAB Tests
The automatic test mode uses a default setting to run tests written using the MATLAB Unit Testing Framework and/or Simulink Test. If your source code is organized as files and folders within a project, the plugin includes any test files in the project that have been tagged as **Test**. If your code does not leverage a project or uses a MATLAB release before R2019a, the plugin includes all tests in the current Jenkins workspace including the subfolders. 

If you use a source code management (SCM) system such as Git, then your job must include the appropriate SCM configuration to check out the code before it can invoke the MATLAB plugin. If you do not use any SCM systems to manage your code, then an additional build step is required to ensure that the code is available in the Jenkins workspace before the build starts **(What is this step?)**.

The automatic test execution feature of the plugin enables you to generate different types of test artifacts. To publish the test results, you can use these artifacts with other Jenkins plugins.
 The selected artifacts will be saved in the **matlabTestArtifacts** folder of the Jenkins workspace.
 
   The automatic test mode results in a MATLAB script file named **runMatlabTests.m** in the Jenkins workspace. The plugin uses this file to run the tests and generate the test artifacts. You can review the contents of the script to understand the testing workflow.
  **Note:** Producing a PDF test report is not currently supported on MacOS platforms.
 
 ![run_matlab_tests_matrix](https://user-images.githubusercontent.com/48831250/76800820-d2629a00-67aa-11ea-9fa7-c466e8c17f27.png)


If you do not select any of the test artifact check boxes, the **matlabTestArtifacts** folder is not created in the workspace. However, the tests still run and test failures fail the build. 

 
### Run MATLAB Command
The custom test mode option enables you to develop custom MATLAB commands for running tests. 
 **Note:** If you need several MATLAB commands to run your tests, consider writing a MATLAB script or function as part of your repository and executing this script or function instead. Test artifacts are not autogenerated if you choose to run tests using custom MATLAB commands. You can generate your desired test artifacts by configuring the test runner in the script or function that you invoke from the **MATLAB command** box.

If you specify more than one MATLAB command, use a comma or semicolon to separate the commands. The build fails if the execution of any command results in an error.

![run_matlab_commands](https://user-images.githubusercontent.com/48831250/76801842-d2fc3000-67ac-11ea-9174-0a6485595714.png)

 
	
## Freestyle Project Setup
To configure the plugin for a freestyle project, select **Use MATLAB Version** from the **Build Environment** section of the project configuration window. Then, enter the value returned by the **matlabroot** function in the **MATLAB root** box. To run 
  
![build_environment](https://user-images.githubusercontent.com/48831250/76798534-23bc5a80-67a6-11ea-9a48-861cbbc7b0ba.png)
  
### Run MATLAB Tests
 To configure the Jenkins build so that MATLAB tests run automatically, follow these steps:

1) From the **Test mode** drop-down list, select the **Automatic** option (**Automatic** is the default testing mode).

2) Select your desired test artifacts.

### Run MATLAB Command
To configure the Jenkins build so that you can customize the MATLAB test execution, follow these steps:

1) From the **Test mode** drop-down list, select the **Custom** option.

2) Enter your commands in the **MATLAB command** field. 


## Multi-Configuration Project Setup
In addition to freestyle projects, the Jenkins plugin for MATLAB supports [multi-configuration (matrix) projects](https://wiki.jenkins.io/display/JENKINS/Building+a+matrix+project). Multi-configuration projects are useful when builds include similar steps. For example:
* The same test suite is run on different platforms (Windows, Linux, and Mac).
* The same test suite is run using different versions of MATLAB.

As in a freestyle project, you can run your tests in automatic or custom mode within a multi-configuration project. The configuration requires you to specify the location where MATLAB is installed as well as the test execution mode. You should also add user-defined axes in the **Configuration Matrix** to specify the duplicating build steps. 

### Run MATLAB Tests

To configure the plugin for a matrix build where tests run automatically in multiple MATLAB versions, create a multi-configuration project and follow these steps:

![build_environment_matrix](https://user-images.githubusercontent.com/48831250/76800665-87488700-67aa-11ea-9dbd-3c3ab518afa7.png)

![axis_version](https://user-images.githubusercontent.com/48831250/76800706-9a5b5700-67aa-11ea-98f0-25f2b7f3658c.png)

![axis_version_testtag](https://user-images.githubusercontent.com/48831250/76800736-aa733680-67aa-11ea-86a7-a984d5795e11.png)


1) Add a user-defined axis in the **Configuration Matrix** to represent the MATLAB versions in the build. Specify the name of the axis in the **Name** field and its values in the **Values** field. Separate the elements in the **Values** field with a space. In this example, four MATLAB versions are specified to run the same set of tests.



2) In the **Run MATLAB Tests** section of the project, include the user-defined axis name in the **MATLAB root** field to specify the locations where MATLAB is installed. In this example, **$VERSION** will be replaced by one axis value per build step.



You can select the test artifact check boxes when tests run automatically. Once you have made your selections, save your settings and run the build.

**Note:** Producing a PDF test report is not currently supported on MacOS platforms.

### Run MATLAB Command

To configure the matrix build where you can customize the MATLAB test execution, create a multi-configuration project and follow these steps:

![run_matlab_command_matrix](https://user-images.githubusercontent.com/48831250/76800855-e3131000-67aa-11ea-99c8-f18b811eea6f.png)


1) Add a user-defined axis in the **Configuration Matrix** to represent the MATLAB versions in the build. 



2) Add another user-defined axis using the **Add axis** button. In this example, the **TEST_TAG** axis specifies the possible test tags for a group of test elements.



3) In the **Run MATLAB Tests** section of the project, use the **VERSION** axis to specify the locations where MATLAB is installed.


4) From the **Test mode** drop-down list, select the **Custom** option. Use the second user-defined axis to create your commands and enter them in the **MATLAB command** field. Then, save your settings and run the build. 


**Notes:**
1) For a user-defined axis named **VAR**,  **$VAR** and **${VAR}** are both valid formats for accessing the values.

2) A multi-configuration project creates a separate workspace for each user-defined axis value. If you specify the full paths to where MATLAB is installed as axis values, Jenkins fails to create separate workspaces and fails the build.	
